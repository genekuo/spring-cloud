./gradlew build && docker-compose build

./test-all.sh start

unset ACCESS_TOKEN
ACCESS_TOKEN=$(curl -k https://writer:secret@localhost:8443/oauth/token -d grant_type=password -d username=magnus -d password=password -s | jq -r .access_token)
echo $ACCESS_TOKEN

[Success API request]
curl -H "Authorization: Bearer $ACCESS_TOKEN" -k https://localhost:8443/product-composite/2 -w "%{http_code}\n" -o /dev/null -s

http://localhost:9411/zipkin
Service Name: gateway
Sort order: Newest First
Find Traces
Select first trace

[Unsuccess API request]
curl -H "Authorization: Bearer $ACCESS_TOKEN" -k https://localhost:8443/product-composite/12345 -w "%{http_code}\n" -o /dev/null -s
http://localhost:9411/zipkin

[API request triggers asynchronous]
curl -X DELETE -H "Authorization: Bearer $ACCESS_TOKEN" -k https://localhost:8443/product-composite/12345 -w "%{http_code}\n" -o /dev/null -s

[Search request]
[Annotation Query]
http.path=/product-composite/214 or error=401
[Limit]
10
[Lookback]

[RabbitMQ web UI]
http://localhost:15672/#/queues/%2F/zipkin
quest/quest
[Message Rates]

docker-compose down

[Kafka]
export COMPOSE_FILE=docker-compose-kafka.yml

./gradlew build && docker-compose build

./test-all.sh start

[repeat previous commands]

[Trace Kafka events]
[find topic name]
docker-compose exec kafka /opt/kafka/bin/kafka-topics.sh --zookeeper --list

[find trace events]
docker-compose exec kafka /opt/kafka/bin/kafka-console-consumner.sh --bootstrap-server localhost:9092 --topic zipkin --from-beginning --timeout-ms 1000

docker-compose down

[clean up]
docker stop $(docker ps -a -q)
docker rm $(docker ps -a -q)
docker rmi $(docker images -a -q)
